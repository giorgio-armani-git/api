openapi: "3.0.0"
info:
  title: Digital Assets API
  description: Digital Assets API exposes the method to retrieve different types of digital assets <p> GET method to retrieve digital assets for a specific item-id <p> GET method to retrieve in synchronous mode the complete collection of digital assets for multiple item-ids <p> POST method to task resource to asynchronously retrieve the complete collection of digital assets for multiple item-ids <p> GET method to query the status of the task resource
  version: "1.0.0"
servers:
  - url: '{protocol}://{environment}.armani.it/v1/digital-assets'
    variables:
      protocol:
        enum:
          - https
        default: https
      environment:
        default: api    # Production server
        enum:
          - api      # Production server
          - apidev   # Development server
          - apitst   # Test server

paths:
  /media-item/:
    get:
      description: Return URLs of media items for the specified item-id, i.e. images and / or video
      parameters:
        - name: style
          in: query
          type: string
          description: ID of the style of the item the query refers to
          required: true
          example: "6LSG03"
        - name: fabric
          in: query
          type: string
          description: ID of the fabric of the item the query refers to
          required: true
          example: "SM17Z"
        - name: color
          in: query
          type: string
          description: ID of the color of the item the query refers to
          required: true
          example: "F8G8"
        - name: barcode
          in: query
          description: barcode
          required: false
          explode: true
          schema:
            type: string
            example: "800012927333"
        - name: asset-type
          in: query
          description: the type of assets (i.e. image, video, swatch, 3d etc.)
          required: false
          explode: true
          schema:
            $ref: "asset-type.yaml#/components/schemas/asset-type"
        - name: asset-category
          in: query
          description: Requester of the image (marketing samples, e-commerce, social media)
          required: false
          schema:
            $ref: "asset-category.yaml#/components/schemas/asset-category"
        - name: classification
          in: query
          description: The classification of the content, i.e. the views (main,front,side,back etc. )
          required: false
          explode: true
          schema:
            $ref: "content-classification.yaml#/components/schemas/classification"
        - name: creation-date-start
          in: query
          description: the start date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2019-07-21T18:32:28Z"
        - name: creation-date-end
          in: query
          description: the end date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2022-09-19T09:32:05Z"
        - name: last-change-date-start
          in: query
          description: the start date of search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2020-09-21T11:32:28Z"
        - name: last-change-date-end
          in: query
          description: the end date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2022-09-19T09:32:05Z"
        - name: media-width
          in: query
          description: the width in pixel of the media item
          required: false
          schema:
            type: string
            example: "640px"
        - name: media-height
          in: query
          description: the height in pixel of the media item
          required: false
          schema:
            type: string
            example: "640px"
        - name: transaction-id
          in: header
          description: unique identifier of the transaction to be propagated to downstream servers, if not included by the Application calling the API it will be generated by the API Gateway
          required: false
          schema:
            type: string
            format: uuid
        - name: x-Gateway-APIKey
          in: header
          description: API Key assigned to the Application calling the API
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/multi-items-digital-assets"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "405":
          description: Method Not Allowed
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "502":
          description: Bad Gateway
          content:
            application/json:
              schema: 
                $ref: "error.yaml#/components/schemas/error"
        "503":
          description: Service Not Available
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "504":
          description: Gateway Timeout
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"


  /media-item/{item-id}:
    get:
      description: Return URLs of media items for the specified item-id, i.e. images and / or video
      parameters:
        - name: item-id
          in: path
          description: item-id can be the generic item id or the sku
          required: true
          explode: true
          schema:
            type: string
            example: "XYZ010XOI69 001"
        - name: style
          in: query
          type: string
          description: ID of the style of the item the query refers to
          required: true
          example: "6LSG03"
        - name: fabric
          in: query
          type: string
          description: ID of the fabric of the item the query refers to
          required: true
          example: "SM17Z"
        - name: color
          in: query
          type: string
          description: ID of the color of the item the query refers to
          required: true
          example: "F8G8"
        - name: barcode
          in: query
          description: barcode
          required: false
          explode: true
          schema:
            type: string
            example: "800012927333"
        - name: asset-type
          in: query
          description: the type of assets (i.e. image, video, swatch, 3d etc.)
          required: false
          explode: true
          schema:
            $ref: "asset-type.yaml#/components/schemas/asset-type"
        - name: asset-category
          in: query
          description: Requester of the image (marketing samples, e-commerce, social media)
          required: false
          schema:
            $ref: "asset-category.yaml#/components/schemas/asset-category"
        - name: classification
          in: query
          description: The classification of the content, i.e. the views (main,front,side,back etc. )
          required: false
          explode: true
          schema:
            $ref: "content-classification.yaml#/components/schemas/classification"
        - name: creation-date-start
          in: query
          description: the start date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2019-07-21T18:32:28Z"
        - name: creation-date-end
          in: query
          description: the end date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2022-09-19T09:32:05Z"
        - name: last-change-date-start
          in: query
          description: the start date of search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2020-09-21T11:32:28Z"
        - name: last-change-date-end
          in: query
          description: the end date of the search interval
          required: false
          schema:
            type: string
            format: date-time
          example: "2022-09-19T09:32:05Z"
        - name: media-width
          in: query
          description: the width in pixel of the media item
          required: false
          schema:
            type: string
            example: "640px"
        - name: media-height
          in: query
          description: the height in pixel of the media item
          required: false
          schema:
            type: string
            example: "640px"
        - name: transaction-id
          in: header
          description: unique identifier of the transaction to be propagated to downstream servers, if not included by the Application calling the API it will be generated by the API Gateway
          required: false
          schema:
            type: string
            format: uuid
        - name: x-Gateway-APIKey
          in: header
          description: API Key assigned to the Application calling the API
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful Operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/multi-items-digital-assets"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "405":
          description: Method Not Allowed
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "502":
          description: Bad Gateway
          content:
            application/json:
              schema: 
                $ref: "error.yaml#/components/schemas/error"
        "503":
          description: Service Not Available
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "504":
          description: Gateway Timeout
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
                
  /media-items:
    get:
      description: return urls of media items of a group of item-ids, it can be the complete set of digital assets for a brand / season however query parameters can be used to narrow down the search
      parameters:
        - name: brand
          in: query
          description: the brand the search refers to
          required: true
          schema:
            $ref: "brand.yaml#/components/schemas/brand"
        - name: season
          in: query
          description: the season the search refers to
          required: true
          schema:
            type: string
            example: "FW22"
        - name: item-id
          in: query
          description: the style-fabric-color IDs of the items the search refers to
          required: false
          explode: true
          schema:
            type: array
            items:
              type: string
              maxItems: 50
        - name: barcode
          in: query
          description: the barcode
          required: false
          explode: true
          schema:
            type: array
            items:
              type: string
              maxItems: 50
        - name: asset-type
          in: query
          description: type of digital asset (image, web, video etc.)
          required: false
          explode: true
          schema:
            $ref: "asset-type.yaml#/components/schemas/asset-type"
        - name: classification
          in: query
          description: classification of the image digital asset, i.e. the image view
          required: false
          explode: true
          schema:
            $ref: "content-classification.yaml#/components/schemas/classification"
        - name: asset-category
          in: query
          description: the category of the digital asset, i.e. whether the digital asset has been created for marketing, web or social media
          required: false
          schema:
            $ref: "asset-category.yaml#/components/schemas/asset-category"
        - name: service
          in: query
          description: additional categorization of the digital assets
          required: false
          schema:
            type: string
            example: "armani.com"
        - name: gender
          in: query
          description: add description
          required: false
          schema:
            type: string
            example: "M"
        - name: media-width
          in: query
          description: add description
          required: false
          schema:
            type: string
            example: "640px"
        - name: media-height
          in: query
          description: add description
          required: false
          schema:
            type: string
            example: "640px"
        - name: last-change-date
          in: query
          description: add description
          required: false
          schema:
            type: string
            format: date-time
            example: "2022-09-19T05:56:18Z"
        - name: creation-date
          in: query
          description: add description
          required: false
          schema:
            type: string
            format: date-time
            example: "2022-09-19T05:56:18Z"
        - name: limit
          in: query
          description: Limits the number of returned results
          required: false
          schema:
            type: integer
            format: int32
          example: 100
        - name: offset
          in: query
          description: Offset from which start returned results
          required: false
          schema:
            type: integer
            format: int32
          example: 0
        - name: transaction-id
          in: header
          description: Unique identifier of the transaction, if not included in the client request it will be generated by the API Gateway
          required: false
          schema:
            type: string
        - name: x-Gateway-APIKey
          in: header
          description: header carrying the API Key assigned to the Application that is calling the digital-assets API
          required: true
          schema:
            type: string
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/multi-items-digital-assets"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "405":
          description: Method Not Allowed
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "502":
          description: Bad Gateway
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "503":
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "504":
          description: Gateway Timeout
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
    
  /media-items/bulk-retrieve:
    post:
      description: endpoint to trigger asynchronous task to retrieve list of digital assets URLs
      parameters:
        - name: transaction-id
          in: header
          description: unique identifier of the transaction, if not provided by the API Client it will be generated by the API Gateway and propagated to the backend systems
          required: false
          schema:
            type: string
            format: uuid
            example: "87fcfd32-caf4-46e6-98b2-18a284ddd9d1"
        - name: x-Gateway-APIKey
          in: header
          description: header carrying the API Key assigned to the Application that is calling the digital-assets API
          required: true
          schema:
            type: string
            example: "cb6298ab-1fb3-4fa5-ac96-dfe9c9f4a18a"
      requestBody:
        description: The request body of the POST request carrying the properties to implement search on the backend
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - brand
                - season
              properties:
                brand:
                  description: The brand the bulk search refers to
                  $ref: "brand.yaml#/components/schemas/brand"
                season:
                  description: The season the bulk search refers to
                  type: string
                  example: "FW22"
                gender:
                  description: The gender the bulk serach refers to
                  type: string
                  example: "M"
                asset-type:
                  description: The type of digital assets the bulk search refers to (e.g. image, video, etc.)
                  $ref: "asset-type.yaml#/components/schemas/asset-type"
                asset-category:
                  description: The category of digital assets the bulk search refers to (e.g. web)
                  $ref: "asset-category.yaml#/components/schemas/asset-category"
                creation-date-start:
                  description: The start date of the search interval
                  type: string
                  format: date-time
                  example: "2022-09-19T05:56:18Z"
                creation-date-end:
                  description: The end date of the bulk search interval
                  type: string
                  format: date-time
                  example: "2022-09-19T09:06:55Z"
                last-change-date-start:
                  description: The start date of the bulk search interval
                  type: string
                  format: date-time
                  example: "2022-09-19T05:56:18Z"
                laset-change-date-end:
                  description: The end date of the bulk search interval
                  type: string
                  format: date-time
                  example: "2022-09-19T09:06:55Z"
                media-width:
                  description: The width in pixel of the media item
                  type: string
                  example: "640px"
                media-height:
                  description: The height in pixel of the media item
                  type: string
                  example: "640px"
                callbackUrl:
                  description: The URL where API Consumer wants to receive notification about asynchronous task
                  type: string
                  format: uri
                  example: "https://notifications.apiconsumer.com"

      responses:
        "202":
          description: successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/bulk-retrieve-response"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "405":
          description: Method Not Allowed
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "429":
          description: Too Many Requests
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "502":
          description: Bad Gateway
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "503":
          description: Service Not Available
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"
        "504":
          description: Gateway Timeout
          content:
            application/json:
              schema:
                $ref: "error.yaml#/components/schemas/error"

      callbacks:
        myEvent:
          "{$request.body#/callbackUrl}":
            post:
              requestBody:   # Contents of the callback message
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        task-id:
                          description: The identifier of the background task
                          type: string
                          example: "e7236d04-eb8c-4bd8-9f2b-bf8b2c1b7451"
                        task-status:
                          $ref: "task-status.yaml#/components/schemas/task-status"
                          example: "Complete"
                        message:
                          type: string
                          example: "The background task is complete"
                        retrieve-url:
                          type: string
                          format: uri
                          description: Query this URL to retrieve the result of the background task
                      required:
                        - task-id
                        - task-status
                        - message
              responses:   # Expected responses to the callback message
                "201":
                  description: Return this code if the callback is accepted
          
      
    
  /media-items/bulk-retrieve/{task-id}:
      get:
        description: returns the status and the result of the background task
        parameters:
          - name: task-id
            in: path
            description: The identifier of the background task
            required: true
            schema:
              type: string
            example: "e7236d04-eb8c-4bd8-9f2b-bf8b2c1b7451"
          - name: transaction-id
            in: header
            description: The unique identifier of the transaction to be propagated to downstream servers, if not present it will be generated by the API Gateway
            required: false
            schema:
              type: string
              format: uuid
            example: "c1bf1fa3-77f2-4958-97a1-74df933f40ab"
          - name: x-Gateway-APIKey
            in: header
            description: API Key assigned to the Application calling the API
            required: true
            schema:
              type: string
            example: "63543562-de1c-42de-928c-395c557ff022"
              
        responses:
          "200":
            description: successful operation
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    task-id:
                      description: The identifier of the background task
                      type: string
                      example: "eeb37384-a2f5-40e5-8abe-a4bf0e66f2ea"
                    task-status:
                      description: The status of the background task
                      type: string
                      example: "Complete"
                    task-result:
                      $ref: "#/components/schemas/multi-items-digital-assets"

          "400":
            description: Bad Request
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "401":
            description: Unauthorized
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "403":
            description: Forbidden
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "404":
            description: Not Found
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "405":
            description: Method Not Allowed
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "429":
            description: Too Many Requests
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "500":
            description: Internal Server Error
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "502":
            description: Bad Gateway
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "503":
            description: Service Not Available
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
          "504":
            description: Gateway Timeout
            content:
              application/json:
                schema:
                  $ref: "error.yaml#/components/schemas/error"
    
    
security:
  - api-key-auth: []

components:

  securitySchemes:
    api-key-auth:
      type: apiKey
      in: header
      name: x-Gateway-APIKey

  schemas:
      
    bulk-retrieve-response:
      type: object
      required:
        - task-id
      properties:
        task-id:
          description: Unique identifier of the background asynchronous task (assigned by the backend system)
          type: string
          
    multi-items-digital-assets:
      description: add here the description
      type: array
      items:
        $ref: "#/components/schemas/digital-assets"
        
    digital-assets:
      type: object
      description: object encapsulating properties of the digitial asset
      required:
        - item-type
        - item-id
        - href
        - brand
        - season
        - assets
      properties:
        item-type:
          type: string
          enum:
            - generic
            - real
            - style-fabric-color
        item-id:
          description: Unique identifier of the item
          type: string
          examples: "XYZ010XOI69 001"
        href:
          description: Hypertext reference to the item 
          type: string
          format: uri
          examples: 
            Generic Item ID:
              href: "https://api.armani.it/v1/digital-assets/media-item/XYZ010XOI69 001?style=2WHGK03H&fabric=T01QW&color=UC99"
            Real Item ID:
              href: "https://api.armani.it/v1/digital-assets/media-item/XYZ010XOI69 001?style=2WHGK03H&fabric=T01QW&color=UC99"
            Style-Fabric-Color Item ID:
              href: "https://api.armani.it/v1/digital-assets/media-item/?style=2WHGK03H&fabric=T01QW&color=UC99"
        brand:
          description: Brand the item belong to
          $ref: "brand.yaml#/components/schemas/brand"
        gender:
          description: Gender of the product item
          type: string
          example: "M"
        season:
          description: Season of the product item
          type: string
          example: "FW22"
        asset-category:
          $ref: "asset-category.yaml#/components/schemas/asset-category"
        assets:
          description: Array of objets carrying the digital assets corresponding to the item
          type: array
          items:
            $ref: "assets.yaml#/components/schemas/assets"
            
          
